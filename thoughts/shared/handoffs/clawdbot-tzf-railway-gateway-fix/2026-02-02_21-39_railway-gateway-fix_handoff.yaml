---
schema_version: "1.0.0"
mode: handoff
date: 2026-02-02T21:39:45.245Z
session: "clawdbot-tzf-railway-gateway-fix"
outcome: "SUCCEEDED"
primary_bead: "clawdbot-tzf"
---

goal: "Fix Railway deployment 502 errors - gateway binding to 127.0.0.1 instead of 0.0.0.0, channels not initializing"
now: "Railway gateway fully functional: binding to 0.0.0.0, Telegram and Discord channels active, webchat working via trusted proxy"

done_this_session:
  - "Fixed gateway bind: CLI --bind lan flag wasn't reliably overriding config - now set gateway.bind='lan' directly in config file"
  - "Fixed proxy trust: Added trustedProxies=['100.64.0.0/10', '10.0.0.0/8'] for Railway internal proxy"
  - "Fixed Telegram channel: Configured botToken from OPENCLAW_TELEGRAM_BOT_TOKEN env var"
  - "Fixed Discord channel: Configured token (not botToken) from OPENCLAW_DISCORD_TOKEN env var"
  - "Fixed USER node: Commented out in Dockerfile for Railway volume permissions"
  - "Created Railway skill at ~/.pi/agent/skills/railway/"

root_causes:
  - "CLI --bind flag doesn't reliably override config file setting - must set in config"
  - "Railway reverse proxy (100.64.0.x) wasn't in trustedProxies"
  - "Discord config key is 'token' not 'botToken' (unlike Telegram)"
  - "Dockerfile USER node prevents writing to Railway volumes (owned by root)"

architecture:
  local_mac: "OpenClaw → Ghostty TUI"
  railway: "OpenClaw → Telegram (iPhone), Discord (iPad), Webchat"
  shared: "chipbot workspace via git sync"

files:
  - "railway-init.sh - main configuration script, sets gateway.bind, trustedProxies, channels"
  - "railway.toml - Railway deployment config"
  - "Dockerfile - USER node commented out for Railway"
  - "~/.pi/agent/skills/railway/ - new Railway CLI skill"

verification:
  - "Telegram: working on Railway (@dales_chip_bot)"
  - "Discord: working on Railway (@Chip)"
  - "Local Mac: Telegram disabled to prevent 409 conflict"

next:
  - "Set up git sync for chipbot workspace between local and Railway"
  - "Consider adding specific Railway proxy IPs to trustedProxies (currently showing warnings)"

git:
  branch: "main"
  commit: "15d07c544b7c719e5f0cfb161cd4cbdbb91b824c"
  remote: "https://github.com/carmandale/clawdis.git"

service_url: "https://clawdbot-production-3c52.up.railway.app"
